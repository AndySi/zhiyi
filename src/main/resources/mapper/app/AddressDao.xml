<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.idou.modules.app.dao.AddressDao">
    <select id="queryList" resultType="com.idou.modules.app.entity.ApiAddressEntity">
        SELECT
          a.*,
          u.`nickName`,
          u.`utel`
        FROM
          `t_address` a,
          `t_user` u
        WHERE a.`userId` = u.id
        <if test="utel!=null and utel!=''">
            AND u.`utel` LIKE CONCAT('%',#{utel},'%')
        </if>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>

    <select id="queryTotal" resultType="int">
        SELECT
          COUNT(*)
        FROM
          `t_address` a,
          `t_user` u
        WHERE a.`userId` = u.id
        <if test="utel!=null and utel!=''">
            AND u.`utel` LIKE CONCAT('%',#{utel},'%')
        </if>
    </select>

    <select id="queryInfoById" resultType="com.idou.modules.app.entity.ApiAddressEntity">
      SELECT * FROM `t_address` WHERE `id` = #{value}
    </select>

    <select id="queryListByUid" resultType="com.idou.modules.app.entity.ApiAddressEntity">
        SELECT * FROM `t_address` WHERE `userId` = #{value}  ORDER BY isDefault
    </select>

    <insert id="save" parameterType="com.idou.modules.app.entity.ApiAddressEntity" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `t_address` (
          `id`,
          `tel`,
          `uName`,
          `userId`,
          `address`,
          `isDefault`,
          `createTime`
        )
        VALUES
          (
            #{id},
            #{tel},
            #{uName},
            #{userId},
            #{address},
            #{isDefault},
            NOW()
          )
    </insert>

    <update id="updateByInfo" parameterType="com.idou.modules.app.entity.ApiAddressEntity">
        UPDATE
        `t_address`
        <set>
            <if test="tel!=null and tel!=''">
                `tel` = #{tel},
            </if>
            <if test="uName!=null and uName!=''">
                `uName` = #{uName},
            </if>
            <if test="address!=null and address!=''">
                `address` = #{address},
            </if>
            <if test="isDefault!=null">
                `isDefault` = #{isDefault},
            </if>
        </set>
        WHERE `id` = #{id}
    </update>

    <delete id="delete" parameterType="map">
        DELETE
        FROM
          `t_address`
        WHERE `id` = #{id}
    </delete>

    <update id="updateIsDefault" parameterType="com.idou.modules.app.entity.ApiAddressEntity">
        UPDATE
          `t_address`
        SET
          `isDefault` = 1
        WHERE `userId` = #{userId}
    </update>
</mapper>