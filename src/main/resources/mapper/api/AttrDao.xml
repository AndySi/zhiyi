<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.idou.modules.api.dao.AttrDao">
    <insert id="saveName" parameterType="com.idou.modules.api.entity.ApiAttrNameEntity">
        INSERT INTO `t_attr_name` (`name`, `itemTypeId`, `pid`)
        VALUES
          (#{name}, #{itemTypeId}, #{pid})
    </insert>
    <update id="updateName" parameterType="com.idou.modules.api.entity.ApiAttrNameEntity">
        UPDATE
        `t_attr_name`
        <set>
            `name` = #{name},
            `itemTypeId` = #{itemTypeId},
            `pid` = #{pid}
        </set>
        WHERE `id` = #{id}
    </update>
    <delete id="deleteBatchName">
        DELETE
        FROM
        `t_attr_name`
        WHERE `id` IN
        <foreach item="item" collection="array" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>
    <select id="queryNameList" resultType="com.idou.modules.api.entity.ApiAttrNameEntity">
        SELECT
        c.*,
        (SELECT p.name FROM `t_attr_name` p WHERE p.id = c.pid) AS parentName,
        t.`name` AS itemTypeName
        FROM
        t_attr_name c,
        `t_item_type` t
        WHERE c.`itemTypeId` = t.`id`
        <if test="name != null and name != ''">
            AND c.`name` like concat('%',#{name},'%')
        </if>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>
    <select id="queryNameTotal" resultType="int">
        select count(*) from t_attr_name
        <where>
            <if test="name != null and name != ''">
                `name` like concat('%',#{name},'%')
            </if>
        </where>
    </select>
    <select id="queryNameListByPid" resultType="com.idou.modules.api.entity.ApiAttrNameEntity">
      SELECT
          n.`id`,
          n.`itemTypeId`,
          n.`pid`,
          CONCAT(n.`name`, '-', t.`name`) AS `name`
        FROM
          `t_attr_name` n,
          `t_item_type` t
        WHERE n.`itemTypeId` = t.`id`
          AND n.pid = #{value}
    </select>
    <select id="queryNameCountBy" parameterType="com.idou.modules.api.entity.ApiAttrNameEntity" resultType="int">
        SELECT COUNT(*) FROM `t_attr_name` WHERE `itemTypeId` = #{itemTypeId} AND `name` = #{name}
    </select>
    <select id="queryNameListByItemId" resultType="com.idou.modules.api.entity.ApiAttrNameEntity">
        SELECT
          n.`id`,
          n.`name`
        FROM
          `t_attr_name` n,
          `t_item` i
        WHERE n.`itemTypeId` = i.`typeId`
          AND i.`id` = #{itemId}
    </select>

    <insert id="saveValue" parameterType="com.idou.modules.api.entity.ApiAttrValueEntity">
        INSERT INTO `t_attr_value` (`value`, `nameId`)
        VALUES
          (#{value}, #{nameId})
    </insert>
    <update id="updateValue" parameterType="com.idou.modules.api.entity.ApiAttrValueEntity">
        UPDATE
          `t_attr_value`
        SET
          `value` = #{value},
          `nameId` = #{nameId}
        WHERE `id` = #{id}
    </update>
    <delete id="deleteBatchValue">
        DELETE
        FROM
        `t_attr_value`
        WHERE `id` IN
        <foreach item="item" collection="array" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>
    <select id="queryValueList" resultType="com.idou.modules.api.entity.ApiAttrValueEntity">
        SELECT
          v.*,
          CONCAT(n.`name`, '-', t.`name`) AS `name`
        FROM
          t_attr_value v,
          `t_attr_name` n,
          `t_item_type` t
        WHERE v.nameId = n.id
          AND n.`itemTypeId` = t.`id`
        <if test="value != null and value != ''">
            AND v.`value` like concat('%',#{value},'%')
        </if>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>
    <select id="queryValueTotal" resultType="int">
        select count(*) from t_attr_value
        <where>
            <if test="value != null and value != ''">
                `value` like concat('%',#{value},'%')
            </if>
        </where>
    </select>
    <select id="queryValueCountBy" parameterType="com.idou.modules.api.entity.ApiAttrValueEntity" resultType="int">
        SELECT COUNT(*) FROM `t_attr_value` WHERE `value` = #{value} AND `nameId` = #{nameId}
    </select>
    <select id="queryValueListByNameId" resultType="com.idou.modules.api.entity.ApiAttrValueEntity">
        SELECT
          `id`,
          `value`
        FROM
          `t_attr_value`
        WHERE `nameId` = #{nameId}
    </select>
</mapper>